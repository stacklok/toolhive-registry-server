# Example configuration for syncing from the ToolHive Git repository with OAuth authentication
#
# This configuration pulls registry data from the official ToolHive repository
# and syncs it to the local storage every 30 minutes.
# All API endpoints require OAuth/OIDC authentication.
#
# Usage:
#   thv-registry-api serve --config examples/config-oauth.yaml

# Registry name/identifier (optional, defaults to "default")
registryName: toolhive

# Registries configuration (can have multiple registries)
registries:
  - name: toolhive
    # Data format: toolhive (native) or upstream (MCP registry format)
    format: toolhive

    # Git repository configuration
    git:
      # Repository URL (HTTP/HTTPS/SSH)
      repository: https://github.com/stacklok/toolhive.git

      # Branch to use (mutually exclusive with tag and commit)
      branch: main

      # Alternative: Use a specific tag
      # tag: v1.0.0

      # Alternative: Use a specific commit SHA
      # commit: abc123def456

      # Path to registry file within the repository
      path: pkg/registry/data/registry.json

    # Per-registry automatic synchronization policy
    syncPolicy:
      # Sync interval (valid duration: 1m, 5m, 30m, 1h, 24h, etc.)
      interval: "30m"

# OAuth/OIDC authentication configuration
auth:
  mode: oauth

  # Additional paths that bypass authentication (optional)
  # These extend the default public paths (health, docs, swagger, well-known)
  # publicPaths:
  #   - /custom/public
  #   - /metrics

  # OAuth/OIDC specific configuration
  oauth:
    # URL identifying this protected resource (RFC 9728)
    # Used in /.well-known/oauth-protected-resource endpoint
    resourceUrl: https://registry.example.com

    # Protection space identifier for WWW-Authenticate header (optional)
    # Defaults to "mcp-registry"
    realm: mcp-registry

    # OAuth scopes supported by this resource (optional)
    # Defaults to ["mcp-registry:read", "mcp-registry:write"]
    scopesSupported:
      - mcp-registry:read
      - mcp-registry:write

    # OAuth/OIDC providers (at least one required)
    # Multiple providers can be configured (e.g., external IDP + Kubernetes)
    providers:
      # Example: External OIDC provider (e.g., Keycloak, Auth0, Okta)
      - name: my-idp
        # OIDC issuer URL (must be HTTPS in production)
        issuerUrl: https://idp.example.com
        # Expected audience claim in the token (REQUIRED)
        audience: api://registry
        # OAuth client ID for token introspection (optional)
        # clientId: registry-client
        # Path to file containing client secret (optional)
        # clientSecretFile: /run/secrets/oauth_client_secret

      # Example: Kubernetes in-cluster authentication
      - name: kubernetes
        issuerUrl: https://kubernetes.default.svc
        audience: https://kubernetes.default.svc
        # Path to CA certificate for verifying Kubernetes API server TLS
        caCertPath: /var/run/secrets/kubernetes.io/serviceaccount/ca.crt

# PostgreSQL database configuration (required)
# Passwords are managed via PostgreSQL's pgpass file (~/.pgpass or $PGPASSFILE)
# See: https://www.postgresql.org/docs/current/libpq-pgpass.html
database:
  host: localhost
  port: 5432
  user: thv_user
  database: toolhive_registry
  sslMode: require

# Optional: Filter configuration to include/exclude specific servers
# filter:
#   # Name-based filtering
#   names:
#     # Only include servers matching these patterns (glob syntax)
#     include:
#       - "stacklok/*"
#       - "official/*"
#     # Exclude servers matching these patterns
#     exclude:
#       - "*/deprecated"
#
#   # Tag-based filtering
#   tags:
#     # Only include servers with these tags
#     include:
#       - "production"
#       - "stable"
#     # Exclude servers with these tags
#     exclude:
#       - "experimental"
#       - "beta"

