# Docker Compose configuration for ToolHive Registry API
#
# This configuration is designed for use with docker-compose.yaml in the repository root.
# It demonstrates database-backed registry with PostgreSQL using the two-user security model.
#
# Prerequisites:
#   - Docker and Docker Compose installed
#   - pgpass file mounted at /root/.pgpass with credentials for both users
#
# Usage:
#   docker-compose up
#
# The docker-compose setup includes:
#   1. postgres - PostgreSQL 18 database server
#   2. registry-api - Main API server (runs migrations automatically on startup)
#
# Two-User Security Model:
#   - db_app: Application user with limited privileges (SELECT, INSERT, UPDATE, DELETE)
#   - db_migrator: Migration user with elevated privileges (CREATE, ALTER, DROP)
#
# Password management via pgpass file (mounted at /root/.pgpass):
#   postgres:5432:registry:db_app:app_password
#   postgres:5432:registry:db_migrator:migration_password

# Registry name/identifier
registryName: docker-registry

# Registries configuration (can have multiple registries)
registries:
  - name: local-file
    # Data format: toolhive (native) or upstream (MCP registry format)
    format: upstream

    # Local file configuration
    # Use file source for docker-compose demo
    # The sample registry file is mounted at /registry-sample.json
    file:
      path: /registry-sample.json

    # Per-registry automatic synchronization policy
    syncPolicy:
      # Check for file changes every 5 minutes
      interval: "5m"

auth:
  mode: anonymous

# PostgreSQL database configuration
# Uses two-user security model: separate users for operations and migrations
database:
  # Use service name from docker-compose as hostname
  host: postgres

  # PostgreSQL default port
  port: 5432

  # Application user (limited privileges: SELECT, INSERT, UPDATE, DELETE)
  # Credentials provided via pgpass file
  user: db_app

  # Migration user (elevated privileges: CREATE, ALTER, DROP)
  # Used for running database schema migrations
  # Credentials provided via pgpass file
  migrationUser: db_migrator

  # Database name (must match POSTGRES_DB in docker-compose.yaml)
  database: registry

  # Disable SSL for local Docker network (NOT for production!)
  sslMode: disable

  # Connection pool settings optimized for local development
  maxOpenConns: 10
  maxIdleConns: 2
  connMaxLifetime: "30m"
