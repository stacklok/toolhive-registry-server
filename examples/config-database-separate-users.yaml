# Example configuration demonstrating separate database users for migrations and operations
#
# This configuration shows how to use different database users:
#   - Migration user: Has elevated privileges (CREATE, ALTER, DROP) for schema changes
#   - Regular user: Has limited privileges (SELECT, INSERT, UPDATE, DELETE) for normal operations
#
# Security Benefits:
#   - Migrations run with elevated privileges only when needed
#   - Normal operations run with minimal required privileges
#   - Reduces attack surface and follows principle of least privilege
#
# Setup Instructions:
#   1. Create PostgreSQL users with appropriate privileges:
#      ```sql
#      -- Migration user with schema modification privileges
#      CREATE USER db_migrator WITH PASSWORD 'migration_password';
#      GRANT ALL PRIVILEGES ON DATABASE toolhive_registry TO db_migrator;
#      GRANT ALL PRIVILEGES ON SCHEMA public TO db_migrator;
#
#      -- Regular user with limited privileges
#      CREATE USER db_app WITH PASSWORD 'app_password';
#      GRANT CONNECT ON DATABASE toolhive_registry TO db_app;
#      GRANT USAGE ON SCHEMA public TO db_app;
#      -- After migrations, grant specific table permissions:
#      GRANT SELECT, INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO db_app;
#      GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO db_app;
#      ```
#
#   2. Create password files or set environment variables:
#      ```bash
#      # Option 1: Password files (recommended for production)
#      echo "app_password" > /secrets/db-password
#      echo "migration_password" > /secrets/db-migration-password
#      chmod 400 /secrets/db-*
#
#      # Option 2: Environment variables (for development)
#      export THV_DATABASE_PASSWORD="app_password"
#      export THV_DATABASE_MIGRATION_PASSWORD="migration_password"
#      ```
#
#   3. Start the server (migrations run automatically with migration user):
#      thv-registry-api serve --config examples/config-database-separate-users.yaml

# Registry name/identifier
registryName: secure-registry

# Data source configuration
source:
  type: git
  format: toolhive
  git:
    repository: https://github.com/stacklok/toolhive.git
    branch: main
    path: pkg/registry/data/registry.json

# Automatic synchronization policy
syncPolicy:
  interval: "30m"

# PostgreSQL database configuration with separate users
database:
  # Database connection details
  host: localhost
  port: 5432
  database: toolhive_registry
  sslMode: require

  # Regular user for normal operations (limited privileges)
  user: db_app
  passwordFile: /secrets/db-password
  # Or use environment variable: THV_DATABASE_PASSWORD

  # Migration user for schema changes (elevated privileges)
  migrationUser: db_migrator
  migrationPasswordFile: /secrets/db-migration-password
  # Or use environment variable: THV_DATABASE_MIGRATION_PASSWORD

  # Connection pool settings
  maxOpenConns: 25
  maxIdleConns: 5
  connMaxLifetime: "5m"
